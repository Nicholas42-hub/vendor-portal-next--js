<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vendor Onboarding Form</title>
    <style>
        /* Include your CSS styles here */
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>
    <input type="hidden" id="description" name="description">
    <div id="iqm1sf" class="row sectionBlockLayout text-left">
        <div id="il202z" class="container">
            <div class="col-md-12 columnBlockLayout">
                <div class="form-style-6">
                    <form id="VendorOnboardingForm" onsubmit="handleSubmit(event)" novalidate>
                        <legend>Vendor Onboarding Form</legend>

                        <h2 class="subtitle">1. Supplier Details</h2>
                        <label for="business_name">Business Name:</label>
                        <input type="text" id="business_name" name="business_name"
                            value="<!-- Fetch from Vendor Creation Page -->" readonly>
                        <label for="trading_name">Trading Name (if different to Business Name):<span
                                class="required-field">*</span></label>
                        <input type="text" id="trading_name" name="trading_name">
                        <label for="Country">Country:<span class="required-field">*</span></label>
                        <select id="Country" name="Country" required>
                            <option value="" disabled selected>Select an option</option>
                            <option value="Afghanistan">Afghanistan</option>
                            <option value="Albania">Albania</option>
                            <option value="Algeria">Algeria</option>
                            <option value="Andorra">Andorra</option>
                            <option value="Angola">Angola</option>
                            <option value="Antigua and Barbuda">Antigua and Barbuda</option>
                            <option value="Argentina">Argentina</option>
                            <option value="Armenia">Armenia</option>
                            <option value="Australia">Australia</option>
                            <option value="Austria">Austria</option>
                            <option value="Azerbaijan">Azerbaijan</option>
                            <option value="Bahamas">Bahamas</option>
                            <option value="Bahrain">Bahrain</option>
                            <option value="Bangladesh">Bangladesh</option>
                            <option value="Barbados">Barbados</option>
                            <option value="Belarus">Belarus</option>
                            <option value="Belgium">Belgium</option>
                            <option value="Belize">Belize</option>
                            <option value="Benin">Benin</option>
                            <option value="Bhutan">Bhutan</option>
                            <option value="Bolivia">Bolivia</option>
                            <option value="Bosnia and Herzegovina">Bosnia and Herzegovina</option>
                            <option value="Botswana">Botswana</option>
                            <option value="Brazil">Brazil</option>
                            <option value="Brunei">Brunei</option>
                            <option value="Bulgaria">Bulgaria</option>
                            <option value="Burkina Faso">Burkina Faso</option>
                            <option value="Burundi">Burundi</option>
                            <option value="Côte d'Ivoire">Côte d'Ivoire</option>
                            <option value="Cabo Verde">Cabo Verde</option>
                            <option value="Cambodia">Cambodia</option>
                            <option value="Cameroon">Cameroon</option>
                            <option value="Canada">Canada</option>
                            <option value="Central African Republic">Central African Republic</option>
                            <option value="Chad">Chad</option>
                            <option value="Chile">Chile</option>
                            <option value="China">China</option>
                            <option value="Colombia">Colombia</option>
                            <option value="Comoros">Comoros</option>
                            <option value="Congo, Democratic Republic of the">Congo, Democratic Republic of the</option>
                            <option value="Congo, Republic of the">Congo, Republic of the</option>
                            <option value="Costa Rica">Costa Rica</option>
                            <option value="Croatia">Croatia</option>
                            <option value="Cuba">Cuba</option>
                            <option value="Cyprus">Cyprus</option>
                            <option value="Czech Republic">Czech Republic</option>
                            <option value="Denmark">Denmark</option>
                            <option value="Djibouti">Djibouti</option>
                            <option value="Dominica">Dominica</option>
                            <option value="Dominican Republic">Dominican Republic</option>
                            <option value="Ecuador">Ecuador</option>
                            <option value="Egypt">Egypt</option>
                            <option value="El Salvador">El Salvador</option>
                            <option value="Equatorial Guinea">Equatorial Guinea</option>
                            <option value="Eritrea">Eritrea</option>
                            <option value="Estonia">Estonia</option>
                            <option value="Eswatini">Eswatini</option>
                            <option value="Ethiopia">Ethiopia</option>
                            <option value="Fiji">Fiji</option>
                            <option value="Finland">Finland</option>
                            <option value="France">France</option>
                            <option value="Gabon">Gabon</option>
                            <option value="Gambia">Gambia</option>
                            <option value="Georgia">Georgia</option>
                            <option value="Germany">Germany</option>
                            <option value="Ghana">Ghana</option>
                            <option value="Greece">Greece</option>
                            <option value="Grenada">Grenada</option>
                            <option value="Guatemala">Guatemala</option>
                            <option value="Guinea">Guinea</option>
                            <option value="Guinea-Bissau">Guinea-Bissau</option>
                            <option value="Guyana">Guyana</option>
                            <option value="Haiti">Haiti</option>
                            <option value="Honduras">Honduras</option>
                            <option value="Hungary">Hungary</option>
                            <option value="Iceland">Iceland</option>
                            <option value="India">India</option>
                            <option value="Indonesia">Indonesia</option>
                            <option value="Iran">Iran</option>
                            <option value="Iraq">Iraq</option>
                            <option value="Ireland">Ireland</option>
                            <option value="Israel">Israel</option>
                            <option value="Italy">Italy</option>
                            <option value="Jamaica">Jamaica</option>
                            <option value="Japan">Japan</option>
                            <option value="Jordan">Jordan</option>
                            <option value="Kazakhstan">Kazakhstan</option>
                            <option value="Kenya">Kenya</option>
                            <option value="Kiribati">Kiribati</option>
                            <option value="Kosovo">Kosovo</option>
                            <option value="Kuwait">Kuwait</option>
                            <option value="Kyrgyzstan">Kyrgyzstan</option>
                            <option value="Laos">Laos</option>
                            <option value="Latvia">Latvia</option>
                            <option value="Lebanon">Lebanon</option>
                            <option value="Lesotho">Lesotho</option>
                            <option value="Liberia">Liberia</option>
                            <option value="Libya">Libya</option>
                            <option value="Liechtenstein">Liechtenstein</option>
                            <option value="Lithuania">Lithuania</option>
                            <option value="Luxembourg">Luxembourg</option>
                            <option value="North Macedonia">North Macedonia</option>
                            <option value="Madagascar">Madagascar</option>
                            <option value="Malawi">Malawi</option>
                            <option value="Malaysia">Malaysia</option>
                            <option value="Maldives">Maldives</option>
                            <option value="Mali">Mali</option>
                            <option value="Malta">Malta</option>
                            <option value="Marshall Islands">Marshall Islands</option>
                            <option value="Mauritania">Mauritania</option>
                            <option value="Mauritius">Mauritius</option>
                            <option value="Mexico">Mexico</option>
                            <option value="Micronesia">Micronesia</option>
                            <option value="Moldova">Moldova</option>
                            <option value="Monaco">Monaco</option>
                            <option value="Mongolia">Mongolia</option>
                            <option value="Montenegro">Montenegro</option>
                            <option value="Morocco">Morocco</option>
                            <option value="Mozambique">Mozambique</option>
                            <option value="Myanmar">Myanmar</option>
                            <option value="Namibia">Namibia</option>
                            <option value="Nauru">Nauru</option>
                            <option value="Nepal">Nepal</option>
                            <option value="Netherlands">Netherlands</option>
                            <option value="New Zealand">New Zealand</option>
                            <option value="Nicaragua">Nicaragua</option>
                            <option value="Niger">Niger</option>
                            <option value="Nigeria">Nigeria</option>
                            <option value="North Korea">North Korea</option>
                            <option value="Norway">Norway</option>
                            <option value="Oman">Oman</option>
                            <option value="Pakistan">Pakistan</option>
                            <option value="Palau">Palau</option>
                            <option value="Panama">Panama</option>
                            <option value="Papua New Guinea">Papua New Guinea</option>
                            <option value="Paraguay">Paraguay</option>
                            <option value="Peru">Peru</option>
                            <option value="Philippines">Philippines</option>
                            <option value="Poland">Poland</option>
                            <option value="Portugal">Portugal</option>
                            <option value="Qatar">Qatar</option>
                            <option value="Romania">Romania</option>
                            <option value="Russia">Russia</option>
                            <option value="Rwanda">Rwanda</option>
                            <option value="St Kitts and Nevis">St Kitts and Nevis</option>
                            <option value="St Lucia">St Lucia</option>
                            <option value="St Vincent and the Grenadines">St Vincent and the Grenadines</option>
                            <option value="Samoa">Samoa</option>
                            <option value="San Marino">San Marino</option>
                            <option value="Sao Tome and Principe">Sao Tome and Principe</option>
                            <option value="Saudi Arabia">Saudi Arabia</option>
                            <option value="Senegal">Senegal</option>
                            <option value="Serbia">Serbia</option>
                            <option value="Seychelles">Seychelles</option>
                            <option value="Sierra Leone">Sierra Leone</option>
                            <option value="Singapore">Singapore</option>
                            <option value="Slovakia">Slovakia</option>
                            <option value="Slovenia">Slovenia</option>
                            <option value="Solomon Islands">Solomon Islands</option>
                            <option value="Somalia">Somalia</option>
                            <option value="South Africa">South Africa</option>
                            <option value="South Korea">South Korea</option>
                            <option value="South Sudan">South Sudan</option>
                            <option value="Spain">Spain</option>
                            <option value="Sri Lanka">Sri Lanka</option>
                            <option value="Sudan">Sudan</option>
                            <option value="Suriname">Suriname</option>
                            <option value="Sweden">Sweden</option>
                            <option value="Switzerland">Switzerland</option>
                            <option value="Syria">Syria</option>
                            <option value="Taiwan">Taiwan</option>
                            <option value="Tajikistan">Tajikistan</option>
                            <option value="Tanzania">Tanzania</option>
                            <option value="Thailand">Thailand</option>
                            <option value="Timor-Leste">Timor-Leste</option>
                            <option value="Togo">Togo</option>
                            <option value="Tonga">Tonga</option>
                            <option value="Trinidad and Tobago">Trinidad and Tobago</option>
                            <option value="Tunisia">Tunisia</option>
                            <option value="Turkey">Turkey</option>
                            <option value="Turkmenistan">Turkmenistan</option>
                            <option value="Tuvalu">Tuvalu</option>
                            <option value="Uganda">Uganda</option>
                            <option value="Ukraine">Ukraine</option>
                            <option value="United Arab Emirates">United Arab Emirates</option>
                            <option value="United Kingdom">United Kingdom</option>
                            <option value="United States of America">United States of America</option>
                            <option value="Uruguay">Uruguay</option>
                            <option value="Uzbekistan">Uzbekistan</option>
                            <option value="Vanuatu">Vanuatu</option>
                            <option value="Vatican City">Vatican City</option>
                            <option value="Venezuela">Venezuela</option>
                            <option value="Vietnam">Vietnam</option>
                            <option value="Yemen">Yemen</option>
                            <option value="Zambia">Zambia</option>
                            <option value="Zimbabwe">Zimbabwe</option>
                        </select>
                        <!-- Registered for GST -->
                        <label for="gst_registered">Registered for GST?:<span class="required-field">*</span></label>
                        <select id="gst_registered" name="gst_registered" required>
                            <option value="" disabled selected>Select Yes or No</option>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                        <div id="au-field" class="au-field hidden">
                            <label for="abn">Australian Business Number (ABN):<span
                                    class="required-field">*</span></label>
                            <input type="text" id="abn" name="abn" inputmode="numeric" required>
                        </div>

                        <div id='nz-field' class="nz-field hidden">
                            <label for="gst">New Zealand Goods & Services Tax Number (GST):<span
                                    class="required-field">*</span></label>
                            <input type="text" id="gst" name="gst" inputmode="numeric" required>
                        </div>

                        <label for="Address">Address:</label>
                        <input type="text" id="Address" name="Address" placeholder="Start typing an address..."
                            autocomplete="off" class="google-places-autocomplete" maxlength="100">
                        <div id="address-error" class="error-message"></div>
                        <label for="website">Website:</label>
                        <input type="text" id="website" name="website">

                        <label for="postal_address">Postal Address:<span class="required-field">*</span></label>
                        <input type="text" id="postal_address" name="postal_address" required>

                        <label for="city">City:<span class="required-field">*</span></label>
                        <input type="text" id="city" name="city" required>

                        <label for="state">State:<span class="required-field">*</span></label>
                        <input type="text" id="state" name="state" required>

                        <label for="postcode">Postcode:<span class="required-field">*</span></label>
                        <input type="text" id="postcode" name="postcode" inputmode="numeric" pattern="\d*" required>

                        <label for="accounts_contact">Primary Contact email:<span
                                class="required-field">*</span></label>
                        <input type="text" id="accounts_contact" name="accounts_contact" required
                            title="Please enter a valid email address (e.g., example@domain.com)" required
                            pattern="[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}" placeholder="example@domain.com"
                            oninput="validateEmail(this, 'poEmailError')" onblur="validateEmail(this, 'poEmailError')">
                        <div id="poEmailError" class="error-message"></div>

                        <label for="telephone">Telephone:<span class="required-field">*</span></label>
                        <input type="text" id="telephone" name="telephone" inputmode="numeric" required>

                        <label for="po_email">PO Email:<span class="required-field">*</span></label>
                        <input type="email" id="po_email" name="po_email"
                            title="Please enter a valid email address (e.g., example@domain.com)" required
                            pattern="[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}" placeholder="example@domain.com"
                            oninput="validateEmail(this, 'poEmailError')" onblur="validateEmail(this, 'poEmailError')">
                        <div id="poEmailError" class="error-message"></div>
                        <label for="return_order_email">Return Order Email:<span class="required-field">*</span></label>
                        <input type="email" id="return_order_email" name="return_order_email" required>
                        <label for="invoice_currency">Invoice Currency:<span class="required-field">*</span></label>
                        <select id="invoice_currency" name="invoice_currency" required>
                            <option value="" disabled selected>Select a currency</option>
                            <option value="AUD">AUD</option>
                            <option value="NZD">NZD</option>
                            <option value="USD">USD</option>
                            <option value="EUR">EUR</option>
                            <option value="CNY">CNY</option>
                            <option value="GBP">GBP</option>
                        </select>

                        <h2 class="subtitle">2. Banking Details</h2>
                        <!-- Payment Method (Dropdown for Bank Transfer or Bepay) -->
                        <label for="payment_method">Payment Method:<span class="required-field">*</span></label>
                        <select id="payment_method" name="payment_method" required onchange="toggleBankDetails()">
                            <option value="" disabled selected>Select Payment Method</option>
                            <option value="Bank Transfer">Bank Transfer</option>
                            <option value="Bepay">Bepay</option>
                        </select>
                        <div id='bank_trasfer'>
                            <div id='au-field-banking' class="au-field hidden">
                                <h2 class="subtitle_sed">Australia</h2>
                                <label for="au_bank_name">Bank Name:<span class="required-field">*</span></label>
                                <input type="text" id="au_bank_name" name="au_bank_name">
                                <label for="au_bank_email">Bank Email:<span class="required-field">*</span></label>
                                <input type="email" id="au_bank_email" name="au_bank_email"
                                    title="Please enter a valid email address (e.g., example@domain.com)" required
                                    pattern="[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}"
                                    placeholder="example@domain.com" oninput="validateEmail(this, 'auBankEmailError')"
                                    onblur="validateEmail(this, 'auBankEmailError')">
                                <div id="auBankEmailError" class="error-message"></div>
                                <div class="form-container">
                                    <div>
                                        <label for="bsb">BSB:<span class="required-field">*</span></label>
                                        <input type="text" id="bsb" name="bsb" maxlength="6" inputmode="numeric"
                                            pattern="\d*">
                                        <div id="bsb-error" class="error-message"></div>
                                    </div>
                                    <div>
                                        <label for="account" style="margin-top: 10px;">Account Number:<span
                                                class="required-field">*</span></label>
                                        <input type="text" id="account" name="account" maxlength="10"
                                            inputmode="numeric" pattern="\d*">
                                        <div id="account-error" class="error-message"></div>
                                    </div>
                                </div>
                            </div>


                            <div id="nz-field-banking" class="nz-field hidden">
                                <h2 class="subtitle_sed">New Zealand</h2>
                                <label for="nz_bank_name">Bank Name:<span class="required-field">*</span></label>
                                <input type="text" id="nz_bank_name" name="nz_bank_name">
                                <label for="nz_bank_email">Bank Email:<span class="required-field">*</span></label>
                                <input type="email" id="nz_bank_email" name="nz_bank_email"
                                    title="Please enter a valid email address (e.g., example@domain.com)" required
                                    pattern="[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}"
                                    placeholder="example@domain.com" oninput="validateEmail(this, 'nzBankEmailError')"
                                    onblur="validateEmail(this, 'nzBankEmailError')">
                                <div id="nzBankEmailError" class="error-message"></div>
                                <div class="form-container">
                                    <div>
                                        <label for="nz_BSB">BSB:<span class="required-field">*</span></label>
                                        <input type="text" id="nz_BSB" name="nz_BSB" maxlength="6" minlength="6"
                                            inputmode="numeric" pattern="\d*">
                                        <div id="nz_BSB-error" class="error-message"></div>
                                    </div>
                                    <div>
                                        <label for="nz_account" style="margin-top: 10px;">Account Number:<span
                                                class="required-field">*</span></label>
                                        <input type="text" id="nz_account" name="nz_account" maxlength="10"
                                            minlength="10" inputmode="numeric" pattern="\d*">
                                        <div id="nz_account-error" class="error-message"></div>
                                    </div>
                                </div>
                            </div>

                            <div id="overseas-banking" class="overseas-field">
                                <h2 class="subtitle_sed">Overseas</h2>
                                <label for="IBAN_SWITCH_yn">IBAN or SWITCH:</label>
                                <div class="dropdown-input">
                                    <select id="IBAN_SWITCH_yn" name="IBAN_SWITCH_yn" onchange="toggleIBAN_SWITCH()">
                                        <option value="" disabled selected>Select an option</option>
                                        <option value="IBAN">IBAN</option>
                                        <option value="SWITCH">SWITCH</option>
                                    </select>
                                </div>
                                <div id="IBAN_field" class="hidden">
                                    <label for="overseas_bank_email">Bank Email:<span
                                            class="required-field">*</span></label>
                                    <input type="email" id="overseas_bank_email" name="overseas_bank_email" required>
                                    <input type="email" id="overseas_bank_email" name="overseas_bank_email"
                                        title="Please enter a valid email address (e.g., example@domain.com)" required
                                        pattern="[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}"
                                        placeholder="example@domain.com"
                                        oninput="validateEmail(this, 'overseasBankEmailError')"
                                        onblur="validateEmail(this, 'overseasBankEmailError')">
                                    <div id="overseasBankEmailError" class="error-message"></div>
                                    <label for="IBAN_input">IBAN:<span class="required-field">*</span></label>
                                    <input type="text" id="IBAN_input" name="IBAN" maxlength="34" minlength="34">
                                </div>
                                <div id="SWITCH_field" class="hidden">
                                    <label for="SWITCH_input">SWITCH:<span class="required-field">*</span></label>
                                    <input type="text" id="SWITCH_input" name="SWITCH" maxlength="34" minlength="34">
                                </div>
                            </div>

                            <div class="file-upload" style="margin-top: 10px;">
                                <label class="upload-label">
                                    Please attach a recent (last 3 months) bank statement - PDF only
                                    <span class="required-field">*</span>
                                </label>
                                <div id="upload-dropbox" class="upload-dropbox">
                                    <button type="button" id="file-button">Choose a PDF file</button>
                                    <input type="file" id="file-input" name="file_upload" style="display: none;"
                                        accept=".pdf" required>
                                    <span id="file-name"></span>
                                </div>
                                <div id="file-error" class="error-message" style="display: none;">Please upload a PDF
                                    file.
                                </div>
                            </div>
                        </div>

                        <div id='Bpay'>
                            <div id="bepay_details" class="bepay-details" style="display:none;">
                                <label for="biller_code">Biller Code:<span class="required-field">*</span></label>
                                <input type="text" id="biller_code" name="biller_code" pattern="\d+"
                                    title="Only numbers allowed" required>

                                <label for="ref_code">Ref Code:<span class="required-field">*</span></label>
                                <input type="text" id="ref_code" name="ref_code" pattern="\d+"
                                    title="Only numbers allowed" required>
                            </div>

                        </div>
                        <h2 class="subtitle_sed">3. Consent Statement</h2>
                        <div class="terms-container">
                            <label for="termsToggle" class="terms-toggle-label">Please click to view the terms and
                                conditions.<span class="required-field">*</span></label>
                            <input type="checkbox" id="termsToggle" class="terms-toggle">
                            <div id="termsContent" class="terms-content">
                                <div class="terms-section">
                                    <iframe src="/Supplierterm.pdf" width="1100px" height="500px"
                                        frameborder="0"></iframe>
                                    <div class="terms-checkbox">
                                        <input type="checkbox" name="Iagree" required>
                                        <label for="Iagree">Acknowledge the terms and conditions<span
                                                class="required-field">*</span></label>
                                        <div id="iAgree-error" class="error-message" style="display: none;"></div>
                                    </div>
                                </div>

                            </div>
                            <div class="submission">
                                <input type="submit" id="submitBtn" value="Submit onboarding form">
                            </div>
                    </form>

                    <!-- Confirmation Popup -->
                    <div class="popup" id="confirmPopup">
                        <h2>Would you want to proceed?</h2>
                        <div class="button-container">
                            <button type="button" class="btn-yes" onclick="proceedSubmit()">Yes</button>
                            <button type="button" class="btn-no" onclick="closeConfirmPopup()">No</button>
                        </div>
                    </div>

                    <!-- Thank You Popup -->
                    <div class="popup" id="thankYouPopup">
                        <h2>Thank you!</h2>
                        <p>Your form has been successfully submitted. Thanks!</p>
                        <button type="button" class="btn-ok" onclick="closeThankYouPopup()">OK</button>
                    </div>

                    <!-- Overlay -->
                    <div class="popup-overlay" id="popupOverlay"></div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>


<script>



    // // Banking details validation
    function validateBSB(input) {
        if (!input) return false;

        const value = input.value.replace(/\D/g, '');
        input.value = value;
        const errorElement = document.getElementById(input.id + '-error');

        if (!errorElement) return false;

        if (value.length === 0) {
            input.classList.remove('input-success');
            input.classList.add('input-error');
            errorElement.textContent = 'BSB is required and must be in numerical format.';
            errorElement.style.display = 'block';
            errorElement.className = 'error-message';
            return false;
        } else if (value.length !== 6) {
            input.classList.remove('input-success');
            input.classList.add('input-error');
            errorElement.textContent = 'BSB must be exactly 6 digits.';
            errorElement.style.display = 'block';
            errorElement.className = 'error-message';
            return false;
        } else {
            input.classList.remove('input-error');
            input.classList.add('input-success');
            errorElement.textContent = '';
            errorElement.style.display = 'block';
            errorElement.className = 'success-message';
            return true;
        }
    }

    function validateAccount(input) {
        if (!input) return false; // Check if the input is provided

        const value = input.value.replace(/\D/g, ''); // Remove all non-numeric characters
        input.value = value; // Set the cleaned value back to the input
        const errorElement = document.getElementById(input.id + '-error'); // Get the associated error element

        if (!errorElement) return false; // If there's no error element, exit

        if (value.length === 0) { // Check if the input is empty
            input.classList.remove('input-success');
            input.classList.add('input-error');
            errorElement.className = 'error-message';
            errorElement.textContent = 'Account number is required and must be in numerical format.';
            errorElement.style.display = 'block';
            return false;
        } else if (value.length !== 10) { // Check if the length is exactly 10 digits
            input.classList.remove('input-success');
            input.classList.add('input-error');
            errorElement.className = 'error-message';
            errorElement.textContent = 'Account must be exactly 10 digits.';
            errorElement.style.display = 'block';
            return false;
        } else { // If the account number is valid
            input.classList.remove('input-error');
            input.classList.add('input-success');
            errorElement.textContent = '';
            errorElement.style.display = 'block';
            errorElement.className = 'success-message';
            return true;
        }
    }

    // Add validation listeners only if elements exist
    document.querySelectorAll('#bsb, #nz_BSB').forEach(input => {
        if (input) {
            input.addEventListener('input', () => validateBSB(input));
            input.addEventListener('blur', () => validateBSB(input));
        }
    });

    document.querySelectorAll('#account, #nz_account').forEach(input => {
        if (input) {
            input.addEventListener('input', () => validateAccount(input));
            input.addEventListener('blur', () => validateAccount(input));
        }
    });

    // Form submission handling
    function validateForm() {
        let isValid = true;

        // Validate banking details based on description
        const description = $('#description').val();
        if (description === 'Australia') {
            const bsb = document.getElementById('bsb');
            const account = document.getElementById('account');
            if (bsb && account) {
                console.error(validateBSB(bsb));
                console.error(validateAccount(account));
                isValid = validateBSB(bsb) && validateAccount(account) && isValid;
            }
        } else if (description === 'New Zealand') {
            const nzBsb = document.getElementById('nz_BSB');
            const nzAccount = document.getElementById('nz_account');
            if (nzBsb && nzAccount) {
                isValid = validateBSB(nzBsb) && validateAccount(nzAccount) && isValid;
            }
        }
    }
    function validateNumericField(input, fieldName) {
        if (!input) return false;

        const value = input.value.replace(/\D/g, '');
        input.value = value; // Set the cleaned value back to the input

        // Get or create error element
        let errorElement = document.getElementById(input.id + '-error');
        if (!errorElement) {
            errorElement = document.createElement('div');
            errorElement.id = input.id + '-error';
            errorElement.className = 'error-message';
            input.parentNode.insertBefore(errorElement, input.nextSibling);
        }

        if (value.length === 0) {
            input.classList.remove('input-success');
            input.classList.add('input-error');
            errorElement.textContent = `${fieldName} must be in numerical format.`;
            errorElement.style.display = 'block';
            return false;
        } else {
            input.classList.remove('input-error');
            input.classList.add('input-success');
            errorElement.textContent = '';
            errorElement.style.display = 'none';
            return true;
        }
    }

    function validateIBAN(input) {
        if (!input) return false;

        // Get or create error element
        let errorElement = document.getElementById(input.id + '-error');
        if (!errorElement) {
            errorElement = document.createElement('div');
            errorElement.id = input.id + '-error';
            errorElement.className = 'error-message';
            input.parentNode.insertBefore(errorElement, input.nextSibling);
        }

        // Remove spaces and convert to uppercase
        const value = input.value.replace(/\s/g, '').toUpperCase();

        // IBAN format validation
        const ibanRegex = /^[A-Z]{2}[0-9A-Z]{32}$/;

        if (value.length === 0) {
            input.classList.remove('input-success');
            input.classList.add('input-error');
            errorElement.textContent = 'IBAN is required.';
            errorElement.style.display = 'block';
            return false;
        } else if (value.length !== 34) {
            input.classList.remove('input-success');
            input.classList.add('input-error');
            errorElement.textContent = 'IBAN must be exactly 34 characters.';
            errorElement.style.display = 'block';
            return false;
        } else if (!ibanRegex.test(value)) {
            input.classList.remove('input-success');
            input.classList.add('input-error');
            errorElement.textContent = 'Invalid IBAN format. Must start with 2 letters followed by 32 characters.';
            errorElement.style.display = 'block';
            return false;
        } else {
            input.classList.remove('input-error');
            input.classList.add('input-success');
            errorElement.textContent = '';
            errorElement.style.display = 'none';
            // Format the IBAN with spaces for readability (optional)
            input.value = value.match(/.{1,4}/g).join(' ');
            return true;
        }
    }

    $(document).ready(function () {
        // Initialize form elements
        const form = document.getElementById('VendorOnboardingForm');
        const fileButton = document.getElementById('file-button');
        const fileInput = document.getElementById('file-input');
        const fileName = document.getElementById('file-name');
        const fileError = document.getElementById('file-error');
        const uploadDropbox = document.getElementById('upload-dropbox');
        const fileRequiredHint = document.getElementById('file-required-hint');
        const termsToggle = document.getElementById('termsToggle');
        const termsContent = document.getElementById('termsContent');
        let confirmPopup = document.getElementById("confirmPopup");
        let thankYouPopup = document.getElementById("thankYouPopup");
        let popupOverlay = document.getElementById("popupOverlay");

        // Retrieve user email and handle region selection
        var currentUserEmail = "{{ user.emailaddress1 }}";

        // AJAX request for user data
        webapi.safeAjax({
            type: "GET",
            url: "/_api/contacts?$filter=emailaddress1 eq '" + currentUserEmail + "'&$select=description,emailaddress1",
            contentType: "application/json",
            headers: {
                "Prefer": "odata.include-annotations=*"
            },
            success: function (data, textStatus, xhr) {
                if (data && data.value && data.value.length > 0) {
                    var contact = data.value[0];
                    var description = contact.description;
                    $('#description').val(description);

                    // Handle region visibility
                    const auList = ['Australia'];
                    const oversealist = ['Overseas'];

                    if (auList.includes(description)) {
                        $('.nz-field').addClass('hidden').find('input').prop('required', false);
                        $('.au-field').removeClass('hidden').find('input').prop('required', true);
                        $('.overseas-field').addClass('hidden').find('input').prop('required', false);
                    } else if (oversealist.includes(description)) {
                        $('.nz-field').addClass('hidden').find('input').prop('required', false);
                        $('.au-field').addClass('hidden').find('input').prop('required', false);
                        $('.overseas-field').removeClass('hidden').find('input').prop('required', false);
                    } else {
                        $('.au-field').addClass('hidden').find('input').prop('required', false);
                        $('.nz-field').removeClass('hidden').find('input').prop('required', true);
                        $('.overseas-field').addClass('hidden').find('input').prop('required', false);
                    }
                }
            },
            error: function (xhr, textStatus, errorThrown) {
                console.error("AJAX request failed:", textStatus, errorThrown);
            }
        });

        // Hide elements initially if they exist
        if (fileRequiredHint) fileRequiredHint.style.display = 'none';
        if (fileError) fileError.style.display = 'none';

        // File upload handling
        if (fileButton && fileInput) {
            let isHandlingClick = false;

            fileButton.addEventListener('click', function (event) {
                event.preventDefault();
                event.stopPropagation();
                if (!isHandlingClick) {
                    isHandlingClick = true;
                    fileInput.click();
                    setTimeout(() => { isHandlingClick = false; }, 100);
                }
            });

            fileInput.addEventListener('change', function (e) {
                const file = e.target.files[0];
                if (file) {
                    if (file.type === 'application/pdf') {
                        if (fileName) fileName.textContent = file.name;
                        if (fileError) fileError.style.display = 'none';
                        if (uploadDropbox) uploadDropbox.classList.remove('error');
                        if (fileRequiredHint) fileRequiredHint.style.display = 'none';
                    } else {
                        e.target.value = '';
                        if (fileName) fileName.textContent = '';
                        if (fileError) {
                            fileError.textContent = 'Please upload a PDF file.';
                            fileError.style.display = 'block';
                        }
                        if (uploadDropbox) uploadDropbox.classList.add('error');
                        if (fileRequiredHint) fileRequiredHint.style.display = 'block';
                    }
                } else {
                    if (fileName) fileName.textContent = '';
                    if (fileError) fileError.style.display = 'none';
                    if (uploadDropbox) uploadDropbox.classList.add('error');
                    if (fileRequiredHint) fileRequiredHint.style.display = 'block';
                }
            });
        }

        // Terms and conditions handling
        if (termsToggle && termsContent) {
            termsToggle.addEventListener('click', function () {
                termsContent.style.display = termsContent.style.display === 'block' ? 'none' : 'block';
            });
        }

        // Banking details validation
        function validateBSB(input) {
            if (!input) return false;

            const value = input.value.replace(/\D/g, '');
            input.value = value;
            const errorElement = document.getElementById(input.id + '-error');

            if (!errorElement) return false;

            if (value.length === 0) {
                input.classList.remove('input-success');
                input.classList.add('input-error');
                errorElement.textContent = 'BSB is required and must be in numerical format.';
                errorElement.style.display = 'block';
                errorElement.className = 'error-message';
                return false;
            } else if (value.length !== 6) {
                input.classList.remove('input-success');
                input.classList.add('input-error');
                errorElement.textContent = 'BSB must be exactly 6 digits.';
                errorElement.style.display = 'block';
                errorElement.className = 'error-message';
                return false;
            } else {
                input.classList.remove('input-error');
                input.classList.add('input-success');
                errorElement.textContent = '';
                errorElement.style.display = 'block';
                errorElement.className = 'success-message';
                return true;
            }
        }

        function validateAccount(input) {
            if (!input) return false; // Check if the input is provided

            const value = input.value.replace(/\D/g, ''); // Remove all non-numeric characters
            input.value = value; // Set the cleaned value back to the input
            const errorElement = document.getElementById(input.id + '-error'); // Get the associated error element

            if (!errorElement) return false; // If there's no error element, exit

            if (value.length === 0) { // Check if the input is empty
                input.classList.remove('input-success');
                input.classList.add('input-error');
                errorElement.textContent = 'Account number is required and must be in numerical format.';
                errorElement.style.display = 'block';
                return false;
            } else if (value.length !== 10) { // Check if the length is exactly 10 digits
                input.classList.remove('input-success');
                input.classList.add('input-error');
                errorElement.textContent = 'Account must be exactly 10 digits.';
                errorElement.style.display = 'block';
                return false;
            } else { // If the account number is valid
                input.classList.remove('input-error');
                input.classList.add('input-success');
                errorElement.textContent = '';
                errorElement.style.display = 'block';
                errorElement.className = 'success-message';
                return true;
            }
        }

        // Add validation listeners only if elements exist
        document.querySelectorAll('#bsb, #nz_BSB').forEach(input => {
            if (input) {
                input.addEventListener('input', () => validateBSB(input));
                input.addEventListener('blur', () => validateBSB(input));
            }
        });

        document.querySelectorAll('#account, #nz_account').forEach(input => {
            if (input) {
                input.addEventListener('input', () => validateAccount(input));
                input.addEventListener('blur', () => validateAccount(input));
            }
        });

        // Form submission handling
        function validateForm() {
            let isValid = true;

            const description = $('#description').val();
            if (description === 'Australia') {
                const bsb = document.getElementById('bsb');
                const account = document.getElementById('account');
                const abn = document.getElementById('abn');
                if (bsb && account) {
                    isValid = validateBSB(bsb) && validateAccount(account) && isValid;
                }
                if (abn) {
                    isValid = validateNumericField(abn, 'ABN') && isValid;
                }
            } else if (description === 'New Zealand') {
                const nzBsb = document.getElementById('nz_BSB');
                const nzAccount = document.getElementById('nz_account');
                const gst = document.getElementById('gst');
                if (nzBsb && nzAccount) {
                    isValid = validateBSB(nzBsb) && validateAccount(nzAccount) && isValid;
                }
                if (gst) {
                    isValid = validateNumericField(gst, 'GST') && isValid;
                }
            }

            // Validate postcode and telephone
            const postcode = document.getElementById('postcode');
            const telephone = document.getElementById('telephone');

            if (postcode) {
                isValid = validateNumericField(postcode, 'Postcode') && isValid;
            }
            if (telephone) {
                isValid = validateNumericField(telephone, 'Telephone') && isValid;
            }

            if (description === 'Overseas') {
                const ibanSwitch = document.getElementById('IBAN_SWITCH_yn');
                if (ibanSwitch && ibanSwitch.value === 'IBAN') {
                    const ibanInput = document.getElementById('IBAN_input');
                    if (ibanInput) {
                        isValid = validateIBAN(ibanInput) && isValid;
                    }
                }
            }
            // Check file upload
            if (fileInput && (!fileInput.files || !fileInput.files[0])) {
                if (fileError) {
                    fileError.textContent = 'Please attach a bank statement.';
                    fileError.style.display = 'block';
                }
                if (uploadDropbox) uploadDropbox.classList.add('error');
                if (fileRequiredHint) fileRequiredHint.style.display = 'block';
                if (fileInput) fileInput.focus();
                isValid = false;
            }

            // Check terms and conditions acknowledgement
            const iAgreeCheckbox = document.querySelector('input[name="Iagree"]');
            const iAgreeError = document.getElementById('iAgree-error');

            if (iAgreeCheckbox && !iAgreeCheckbox.checked) {
                if (iAgreeError) {
                    termsToggle.click();
                    iAgreeError.textContent = 'Please acknowledge the terms and conditions.';
                    iAgreeError.style.display = 'block';
                }
                if (termsContent && termsContent.style.display === 'none') {
                    termsToggle.click(); // Expand the terms content if collapsed
                }
                iAgreeCheckbox.focus(); // Focus the checkbox
                isValid = false;
            } else {
                if (iAgreeError) {
                    iAgreeError.style.display = 'none'; // Hide error message if checkbox is checked
                }
            }

            // Show HTML5 validation messages for visible invalid fields
            if (!isValid) {
                const firstInvalidField = Array.from(form.elements)
                    .find(element => !element.closest('.hidden') && !element.checkValidity());
                if (firstInvalidField) {
                    firstInvalidField.reportValidity();
                }
            }
            return isValid;
        }

        // Handle form submission
        if (form) {
            form.addEventListener('submit', function (event) {
                event.preventDefault();
                if (validateForm()) {
                    openConfirmPopup();
                }
            });
        }

        // Popup handling functions
        function openConfirmPopup() {
            if (confirmPopup && popupOverlay) {
                confirmPopup.classList.add('open-popup');
                popupOverlay.classList.add('open-popup-overlay');
            }
        }

        function closeConfirmPopup() {
            if (confirmPopup && popupOverlay) {
                confirmPopup.classList.remove('open-popup');
                popupOverlay.classList.remove('open-popup-overlay');
            }
        }

        // Proceed with form submission after confirmation
        window.proceedSubmit = function () {
            confirmPopup.classList.remove("open-popup");

            var record = {
                lastname: $('#business_name').val(),
                crb7c_abn: $('#abn').val(),
                crb7c_accountcontact: $('#accounts_contact').val(),
                address1_city: $('#city').val(),
                crb7c_nzgst: $('#gst').val(),
                crb7c_invoicecurrency: $('#invoice_currency').val(),
                address1_postofficebox: $('#postal_address').val(),
                address1_postalcode: $('#postcode').val(),
                address1_stateorprovince: $('#state').val(),
                websiteurl: $('#website').val(),
                address1_telephone2: $('#telephone').val(),
                crb7c_tradingname: $('#trading_name').val(),
                crb7c_aubsb: $('#bsb').val(),
                crb7c_auaccount: $('#account').val(),
                crb7c_nzbsb: $('#nz_BSB').val(),
                crb7c_nzaccount: $('#nz_account').val(),
                crb7c_statuscode: "Pending Manager Approval",
                crb7c_vendorsetupstatus: "Pending",
                crb7c_bankname: $('#au_bank_name').val(),
            };

            var encodedFilter = "$filter=" + encodeURIComponent(`emailaddress1 eq '${currentUserEmail}'`);
            webapi.safeAjax({
                type: "GET",
                url: `/_api/contacts?${encodedFilter}&$select=contactid`,
                contentType: "application/json",
                headers: { "Prefer": "odata.include-annotations=*" },
                success: function (data) {
                    if (data && data.value && data.value.length > 0) {
                        var vendor = data.value[0];
                        updateVendorRecord(vendor.contactid, record);
                    } else {
                        console.log("No vendor record found for the current user.");
                        handleError("No vendor record found for the current user.");
                    }
                },
                error: function (xhr, textStatus, errorThrown) {
                    handleError("Error fetching vendor record", xhr, textStatus, errorThrown);
                }
            });
        }

        function updateVendorRecord(contactId, record) {
            webapi.safeAjax({
                type: "PATCH",
                url: `/_api/contacts(${contactId})`,
                contentType: "application/json",
                data: JSON.stringify(record),
                success: function (data, textStatus, xhr) {
                    finishSubmission();
                },
                error: function (xhr, textStatus, errorThrown) {
                    handleError("Error updating vendor record", xhr, textStatus, errorThrown);
                }
            });
        }

        function finishSubmission() {
            openThankYouPopup();
            $('#VendorOnboardingForm')[0].reset();
            setTimeout(() => {
                window.location.href = "https://lagardereawpl-vendorportal.powerappsportals.com/profile/";
            }, 5000);
        }

        function handleError(message, xhr, textStatus, errorThrown) {
            console.error(`${message}:`, textStatus, errorThrown, xhr);
            $('#feedbackMessage').text(`There was an error: ${xhr?.responseText || errorThrown || message}`);
            $('#feedbackModal').css('display', 'block');
        }

        function openThankYouPopup() {
            thankYouPopup.classList.add("open-popup");
            popupOverlay.classList.add("open-popup-overlay");
        }

        function closeThankYouPopup() {
            thankYouPopup.classList.remove("open-popup");
            popupOverlay.classList.remove("open-popup-overlay");
            window.location.href = "https://lagardereawpl-vendorportal.powerappsportals.com/profile/";
        }
    });
    // Define validateForm globally
    function validateForm() {
        let isValid = true;

        const description = $('#description').val();
        if (description === 'Australia') {
            const bsb = document.getElementById('bsb');
            const account = document.getElementById('account');
            const abn = document.getElementById('abn');
            if (bsb && account) {
                isValid = validateBSB(bsb) && validateAccount(account) && isValid;
            }
            if (abn) {
                isValid = validateNumericField(abn, 'ABN') && isValid;
            }
        } else if (description === 'New Zealand') {
            const nzBsb = document.getElementById('nz_BSB');
            const nzAccount = document.getElementById('nz_account');
            const gst = document.getElementById('gst');
            if (nzBsb && nzAccount) {
                isValid = validateBSB(nzBsb) && validateAccount(nzAccount) && isValid;
            }
            if (gst) {
                isValid = validateNumericField(gst, 'GST') && isValid;
            }
        }


        if (description === 'Overseas') {
            const ibanSwitch = document.getElementById('IBAN_SWITCH_yn');
            if (ibanSwitch && ibanSwitch.value === 'IBAN') {
                const ibanInput = document.getElementById('IBAN_input');
                if (ibanInput) {
                    isValid = validateIBAN(ibanInput) && isValid;
                }
            }
        }

        // Validate postcode and telephone
        const postcode = document.getElementById('postcode');
        const telephone = document.getElementById('telephone');

        if (postcode) {
            isValid = validateNumericField(postcode, 'Postcode') && isValid;
        }
        if (telephone) {
            isValid = validateNumericField(telephone, 'Telephone') && isValid;
        }
        // Check file upload
        const fileInput = document.getElementById('file-input');
        const fileError = document.getElementById('file-error');
        const uploadDropbox = document.getElementById('upload-dropbox');
        const fileRequiredHint = document.getElementById('file-required-hint');

        if (fileInput && (!fileInput.files || !fileInput.files[0])) {
            if (fileError) {
                fileError.textContent = 'Please attach a bank statement.';
                fileError.style.display = 'block';
            }
            if (uploadDropbox) uploadDropbox.classList.add('error');
            if (fileRequiredHint) fileRequiredHint.style.display = 'block';
            if (fileInput) fileInput.focus();
            isValid = false;
        }

        // Check terms and conditions acknowledgement
        const iAgreeCheckbox = document.querySelector('input[name="Iagree"]');
        const iAgreeError = document.getElementById('iAgree-error');

        if (iAgreeCheckbox && !iAgreeCheckbox.checked) {
            if (iAgreeError) {
                iAgreeError.textContent = 'Please acknowledge the terms and conditions.';
                iAgreeError.style.display = 'block';
            }
            iAgreeCheckbox.focus();
            isValid = false;
        } else {
            if (iAgreeError) {
                iAgreeError.style.display = 'none';
            }
        }

        return isValid && document.getElementById('VendorOnboardingForm').checkValidity();
    }

    function toggleIBAN_SWITCH() {
        const yn = document.getElementById('IBAN_SWITCH_yn');
        const IBAN = document.getElementById('IBAN_field');
        const switchField = document.getElementById('SWITCH_field');

        if (yn.value === 'IBAN') {
            IBAN.classList.remove('hidden');
            switchField.classList.add('hidden');
        } else if (yn.value === 'SWITCH') {
            IBAN.classList.add('hidden');
            switchField.classList.remove('hidden');
        } else {
            ibanField.classList.add('hidden');
            switchField.classList.add('hidden');
        }

    }

    document.addEventListener('DOMContentLoaded', function () {
        // Add validation listeners
        document.querySelectorAll('#bsb, #nz_BSB').forEach(input => {
            input.addEventListener('input', () => validateBSB(input));
            input.addEventListener('blur', () => validateBSB(input));
        });

        document.querySelectorAll('#account, #nz_account').forEach(input => {
            input.addEventListener('input', () => validateAccount(input));
            input.addEventListener('blur', () => validateAccount(input));
        });

        // Restrict telephone and postcode to numerical input
        document.getElementById('telephone').addEventListener('input', function () {
            this.value = this.value.replace(/\D/g, ''); // Remove non-numeric characters
        });
        // Restrict telephone and postcode to numerical input
        document.getElementById('abn').addEventListener('input', function () {
            this.value = this.value.replace(/\D/g, ''); // Remove non-numeric characters
        });
        // Restrict telephone and postcode to numerical input
        document.getElementById('gst').addEventListener('input', function () {
            this.value = this.value.replace(/\D/g, ''); // Remove non-numeric characters
        });
        document.getElementById('postcode').addEventListener('input', function () {
            this.value = this.value.replace(/\D/g, ''); // Remove non-numeric characters
        });
        const numericFields = [
            { id: 'abn', name: 'ABN' },
            { id: 'gst', name: 'GST' },
            { id: 'postcode', name: 'Postcode' },
            { id: 'telephone', name: 'Telephone' }
        ];
        numericFields.forEach(field => {
            const input = document.getElementById(field.id);
            if (input) {
                // Add validation on input
                input.addEventListener('input', function () {
                    this.value = this.value.replace(/\D/g, '');
                    validateNumericField(this, field.name);
                });

                // Add validation on blur
                input.addEventListener('blur', function () {
                    validateNumericField(this, field.name);
                });

                // Add error div if it doesn't exist
                if (!document.getElementById(field.id + '-error')) {
                    const errorDiv = document.createElement('div');
                    errorDiv.id = field.id + '-error';
                    errorDiv.className = 'error-message';
                    errorDiv.style.display = 'none';
                    input.parentNode.insertBefore(errorDiv, input.nextSibling);
                }
            }
        });

        const ibanInput = document.getElementById('IBAN_input');
        if (ibanInput) {
            ibanInput.addEventListener('input', function () {
                validateIBAN(this);
            });

            ibanInput.addEventListener('blur', function () {
                validateIBAN(this);
            });

            // Add error div if it doesn't exist
            if (!document.getElementById('IBAN_input-error')) {
                const errorDiv = document.createElement('div');
                errorDiv.id = 'IBAN_input-error';
                errorDiv.className = 'error-message';
                errorDiv.style.display = 'none';
                ibanInput.parentNode.insertBefore(errorDiv, ibanInput.nextSibling);
            }
        }
    })

    function handleSubmit(event) {
        event.preventDefault(); // Prevent default form submission
        if (validateForm()) {
            openConfirmPopup(); // Show confirmation popup if the form is valid
        } else {
            console.error('not working')
        }
    }

    function openConfirmPopup() {
        if (confirmPopup && popupOverlay) {
            confirmPopup.classList.add('open-popup');
            popupOverlay.classList.add('open-popup-overlay');
        }
    }

    function closeThankYouPopup() {
        const thankYouPopup = document.getElementById("thankYouPopup");
        const popupOverlay = document.getElementById("popupOverlay");
        if (thankYouPopup && popupOverlay) {
            thankYouPopup.classList.remove("open-popup");
            popupOverlay.classList.remove("open-popup-overlay");
            window.location.href = "https://lagardereawpl-vendorportal.powerappsportals.com/profile/";
        }
    }

    function validateEmail(input, errorDivId) {
        const email = input.value;
        const errorDiv = document.getElementById(errorDivId);
        const emailPattern = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;

        // Clear previous error state
        input.classList.remove('error');
        errorDiv.style.display = 'none';

        // Check if empty
        if (!email) {
            input.classList.add('error');
            errorDiv.textContent = 'Email address is required';
            errorDiv.style.display = 'block';
            return false;
        }

        // Additional validation for minimum length of domain parts
        const parts = email.split('@');
        if (parts.length === 2) {
            const [localPart, domain] = parts;
            const domainParts = domain.split('.');

            // Check domain format
            if (domainParts.length < 2 ||
                domainParts[domainParts.length - 1].length < 2 ||
                domainParts[domainParts.length - 1].length > 4) {
                input.classList.add('error');
                errorDiv.textContent = 'Please enter a valid email domain (e.g., .com, .org, .edu)';
                errorDiv.style.display = 'block';
                return false;
            }
        }

        // Check overall format
        if (!emailPattern.test(email)) {
            input.classList.add('error');
            errorDiv.textContent = 'Please enter a valid email address (e.g., example@domain.com)';
            errorDiv.style.display = 'block';
            return false;
        }

        return true;
    }

    function toggleBankDetails() {
        var paymentMethod = document.getElementById("payment_method").value;
        if (paymentMethod === "Bepay") {
            document.getElementById("bank_trasfer").style.display = "none";
            document.getElementById("bepay_details").style.display = "block";
        } else {
            document.getElementById("bank_trasfer").style.display = "block";
            document.getElementById("bepay_details").style.display = "none";
        }
    }

    // Ensure the input field is hidden initially
    document.addEventListener('DOMContentLoaded', () => {
        toggleSettlementDiscount();
    });
</script>

(function(webapi, $){
    function safeAjax(ajaxOptions) {
        var deferredAjax = $.Deferred();

        shell.getTokenDeferred().done(function (token) {
            // add headers for AJAX
            if (!ajaxOptions.headers) {
                $.extend(ajaxOptions, {
                    headers: {
                        "__RequestVerificationToken": token
                    }
                }); 
            } else {
                ajaxOptions.headers["__RequestVerificationToken"] = token;
            }
            $.ajax(ajaxOptions)
                .done(function(data, textStatus, jqXHR) {
                    validateLoginSession(data, textStatus, jqXHR, deferredAjax.resolve);
                }).fail(deferredAjax.reject); //AJAX
        }).fail(function () {
            deferredAjax.rejectWith(this, arguments); // on token failure pass the token AJAX and args
        });

        return deferredAjax.promise();	
    }
    webapi.safeAjax = safeAjax;
})(window.webapi = window.webapi || {}, jQuery)


const dropbox = document.getElementById('upload-dropbox');
const fileInput = document.getElementById('file-input');
const feedback = document.createElement('div'); // Create a feedback div

// Insert feedback div into the DOM
dropbox.appendChild(feedback);

dropbox.addEventListener('click', () => {
fileInput.click();
});

dropbox.addEventListener('dragover', (e) => {
e.preventDefault();
dropbox.classList.add('dragover');
});

dropbox.addEventListener('dragleave', () => {
dropbox.classList.remove('dragover');
});

dropbox.addEventListener('drop', (e) => {
e.preventDefault();
dropbox.classList.remove('dragover');
const files = Array.from(e.dataTransfer.files);
handleFiles(files);
});

fileInput.addEventListener('change', (e) => {
const files = Array.from(e.target.files);
handleFiles(files);
});

function handleFiles(files) {
feedback.innerHTML = ''; // Clear previous feedback

if (files.length > 0) {
    files.forEach(file => {
        console.log(file.name);
        // Provide feedback
        const listItem = document.createElement('div');
        listItem.textContent = `${file.name} - ${file.size} bytes`;
        listItem.classList.add('file-item');
        feedback.appendChild(listItem);
    });
    feedback.classList.add('success');
} else {
    feedback.textContent = 'No files selected';
    feedback.classList.add('error');
}
};

.sectionBlockLayout {
    display: flex;
    flex-wrap: wrap;
    margin: 0;
    min-height: auto;
    padding: 8px;
  }
  
  .container {
    padding: 0;
    display: flex;
    flex-wrap: wrap;
  }
  
  .columnBlockLayout {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    min-width: 250px;
    word-break: break-word;
  }
  
  
  .form-style-6 {
    background: #f7f7f7;
    padding: 20px;
    margin: 10px 0;
    border-radius: 8px;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
    width: 100%;
  }
  
  .form-style-6 legend {
    font-family: -apple-system, "system-ui", "Segoe UI", Roboto, Oxygen, Ubuntu, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
    font-size: 24px;
    font-weight: 800;
    color: rgb(31, 31, 35);
  }
  
  .form-style-6 .subtitle,
  .form-style-6 .subtitle_sed {
    font-size: 1.2em;
    margin-bottom: 20px;
    box-sizing: border-box;
    color: rgb(31, 31, 35);
    cursor: default;
    display: block;
    font-family: -apple-system, "system-ui", "Segoe UI", Roboto, Oxygen, Ubuntu, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
    font-weight: 600;
    height: 20px;
    letter-spacing: normal;
    line-height: 20px;
    margin-bottom: 4px;
    margin-left: 0;
    margin-right: 0;
    margin-top: 0;
    overflow-x: visible;
    overflow-y: visible;
    text-decoration-color: rgb(31, 31, 35);
    text-decoration-line: none;
    text-decoration-style: solid;
    text-decoration-thickness: auto;
    text-overflow: clip;
    text-rendering: optimizeLegibility;
    text-size-adjust: 100%;
    text-underline-position: from-font;
    width: 538px;
    word-break: break-word;
    -webkit-font-smoothing: antialiased;
    margin-bottom: 10px;
    margin-top: 20px;
  }
  
  .form-style-6 .subtitle_sed {
    font-size: 1em;
    margin-bottom: 10px;
  }
  
  .form-style-6 label {
    box-sizing: border-box;
    color: rgb(31, 31, 35);
    cursor: default;
    display: block;
    font-family: -apple-system, "system-ui", "Segoe UI", Roboto, Oxygen, Ubuntu, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
    font-size: 12px;
    font-weight: 600;
    height: 20px;
    letter-spacing: normal;
    line-height: 20px;
    margin-bottom: 4px;
    margin-left: 0;
    margin-right: 0;
    margin-top: 0;
    overflow-x: visible;
    overflow-y: visible;
    text-decoration-color: rgb(31, 31, 35);
    text-decoration-line: none;
    text-decoration-style: solid;
    text-decoration-thickness: auto;
    text-overflow: clip;
    text-rendering: optimizeLegibility;
    text-size-adjust: 100%;
    text-underline-position: from-font;
    width: 538px;
    word-break: break-word;
    -webkit-font-smoothing: antialiased;
  }
  
  .form-style-6 input[type="text"],
  .form-style-6 input[type="email"],
  .form-style-6 select,
  .form-style-6 input[type="submit"] {
    display: block;
    width: 100%;
    padding: 10px;
    margin-bottom: 10px;
    border: 1px solid #ccc;
    border-radius: 4px;
    box-sizing: border-box;
  }
  
  .form-style-6 input[type="submit"] {
    background-color: #4CAF50; /* Green */
    color: white;
    border: none;
    cursor: pointer;
  }
  
  .form-style-6 input[type="submit"]:hover {
    background-color: #45a049;
  }
  
  .hidden {
    display: none;
  }
  
  .popup {
    width: 400px;
    background: #fff;
    border-radius: 6px;
    position: fixed;
    z-index: 1001;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.1);
    text-align: center;
    padding: 30px;
    color: #333;
    visibility: hidden;
    transition: transform 0.4s, top 0.4s;
  }
  
  .open-popup {
    visibility: visible;
    top: 50%;
    transform: translate(-50%, -50%) scale(1);
  }
  
  
  
  .popup .button-container {
    display: flex;
    justify-content: space-between;
  }
  
  .popup button {
    width: 100px;
    padding: 10px;
    color: white;
    border: none;
    border-radius: 5px;
    font-size: 16px;
    cursor: pointer;
  }
  
  .popup button.btn-yes {
    background-color: #4CAF50;
  }
  .popup button.btn-ok {
    background-color: #4CAF50;
  }
  .popup button.btn-no {
    background-color: #FF0000 !important;
  }
  .popup .button-container {
    display: flex;
    justify-content: space-between;
  }
  
  .popup .button-container button {
    width: 45%; /* Adjust width as needed */
    margin: 0 5px;
  }
  .popup-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    visibility: hidden;
    opacity: 0;
    transition: opacity 0.4s;
    z-index: 999;
  }
  
  .open-popup-overlay {
    visibility: visible;
    opacity: 1;
  }
  
  @media (max-width: 600px) {
    .columnBlockLayout {
        min-width: 100%;
    }
  
    .form-style-6 {
        padding: 15px;
    }
  }
  
  .upload-dropbox {
    border: 2px dashed #ccc;
    padding: 20px;
    text-align: center;
    position: relative;
    border-radius: 10px;
    background-color: #f9f9f9;
  }
  
  .upload-dropbox svg {
    margin-bottom: 10px;
  }
  
  .upload-dropbox button {
    background-color: #e7e7e9;
    color: black;
    border: none;
    padding: 10px 20px;
    font-size: 16px;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  .upload-dropbox button:hover {
    background-color: #e7e7e9;
  }
  
  .upload-dropbox input[type="file"] {
    display: none;
  }
  .drag-area {
    border: 2px dashed #ccc;
    padding: 20px;
    text-align: center;
    cursor: pointer;
  }
  
  .drag-area .icon {
    font-size: 24px;
    margin-bottom: 10px;
  }
  
  
  
  .terms-container {
    max-width: 1200px;
    margin: 0 auto;
  }
  .terms-content {
    display: none;
    border-top: 1px solid #ddd;
    padding-top: 10px;
    margin-top: 10px;
  }
  input[type="checkbox"].terms-toggle {
    display: none;
  }
  input[type="checkbox"].terms-toggle:checked ~ .terms-content {
    display: flex;
    justify-content: space-between;
  }
  label.terms-toggle-label {
    background: none;
    border: none;
    color: blue;
    /* text-decoration: underline; */
    cursor: pointer;
    display: inline-block;
    font-size: 14px;
  }
  .required-field {
    color: red;
    margin-left: 5px;
    text-decoration: none !important;
  }
  label.terms-toggle-label span.required-field {
    text-decoration: none;
  }
  label.terms-toggle-label:focus {
    outline: none;
    }
    .terms-section {
    width: 48%;
    }
    h1, h2 {
    font-weight: bold;
    }
    h1 {
    font-size: 24px;
    }
    h2 {
    font-size: 20px;
    }
    .terms-sub-section {
    margin-left: 20px;
    }
    .terms-sub-section p, .terms-sub-section ul {
    margin: 0;
    }
    .terms-sub-section ul {
    padding-left: 20px;
    }
    
    .terms-checkbox {
      display: flex;
      align-items: center;
  
  }
  .terms-checkbox label{
  margin-top: 10px;
  margin-bottom: 10px;
  font-size: 15px !important;
  font-weight: bold !important;
  }
  .terms-checkbox input[type="checkbox"] {
      margin-right: 8px; /* Adjust the spacing as needed */
      transform: translateY(-2px); /* Adjust this value to align vertically */
  }
  .submission{
    font-weight: bold !important;
  }
  
  .popup h2 {
    font-size: 20px !important;
    font-weight: 500;
    margin: 20px 0 10px;
  }
  .error-message {
      color: red;
      font-size: 0.8em;
      margin-top: 5px;
      display: none;
  }
  
  .input-error {
    border-color: #ff0000 !important;
    background-color: #fff0f0 !important;
  }
  
  .input-success {
    border-color: #28a745;
  }